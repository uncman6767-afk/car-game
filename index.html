<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate 3D Beam.MG Clone</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; }
  #speedometer {
    position: absolute;
    top: 10px; left: 10px;
    color: white;
    font-family: Arial;
    font-size: 24px;
  }
  #score {
    position: absolute;
    top: 40px; left: 10px;
    color: white;
    font-family: Arial;
    font-size: 24px;
  }
</style>
</head>
<body>
<div id="speedometer">Speed: 0 km/h</div>
<div id="score">Score: 0</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>
<script>
// Scene setup
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x555555);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 10, 20);
camera.lookAt(0,0,0);

// Renderer
const renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);
const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
directionalLight.position.set(0,50,50);
scene.add(directionalLight);

// Road
const roadWidth = 10;
const roadLength = 200;
const roadGeometry = new THREE.PlaneGeometry(roadWidth, roadLength);
const roadMaterial = new THREE.MeshStandardMaterial({color:0x333333});
const road = new THREE.Mesh(roadGeometry, roadMaterial);
road.rotation.x = -Math.PI/2;
scene.add(road);

// Lane lines
for(let i=-1;i<=1;i++){
  const lineGeo = new THREE.PlaneGeometry(0.2, roadLength);
  const lineMat = new THREE.MeshStandardMaterial({color:0xffffff});
  const line = new THREE.Mesh(lineGeo, lineMat);
  line.rotation.x = -Math.PI/2;
  line.position.x = i*(roadWidth/3);
  scene.add(line);
}

// Player car
const carGeometry = new THREE.BoxGeometry(1,1,2);
const carMaterial = new THREE.MeshStandardMaterial({color:0x0000ff});
const playerCar = new THREE.Mesh(carGeometry, carMaterial);
playerCar.position.set(0,0.5,0);
scene.add(playerCar);

// AI Cars
const aiCars = [];
const aiColors = [0xff0000,0xffff00,0x00ff00,0xffa500,0x800080];

// Score & Speed
let score = 0;
let speed = 0;

// Controls
const keys = {};
document.addEventListener('keydown', e=>keys[e.key]=true);
document.addEventListener('keyup', e=>keys[e.key]=false);

// Spawn AI car
function spawnAICar(){
  const lane = (Math.floor(Math.random()*3)-1)*(roadWidth/3);
  const color = aiColors[Math.floor(Math.random()*aiColors.length)];
  const geometry = new THREE.BoxGeometry(1,1,2);
  const material = new THREE.MeshStandardMaterial({color:color});
  const car = new THREE.Mesh(geometry, material);
  car.position.set(lane,0.5,-50-Math.random()*50);
  car.speed = 0.2 + Math.random()*0.5;
  scene.add(car);
  aiCars.push(car);
}

// Update
function update(){
  // Player controls
  if(keys['ArrowUp']) speed += 0.02;
  if(keys['ArrowDown']) speed -= 0.01;
  if(keys['ArrowLeft']) playerCar.position.x -= 0.1;
  if(keys['ArrowRight']) playerCar.position.x += 0.1;

  speed *= 0.98;
  if(speed<0) speed=0;
  if(playerCar.position.x < -roadWidth/2+0.5) playerCar.position.x = -roadWidth/2+0.5;
  if(playerCar.position.x > roadWidth/2-0.5) playerCar.position.x = roadWidth/2-0.5;

  // Move road and AI cars towards player
  road.position.z += speed;
  aiCars.forEach(car=>{
    car.position.z += speed + car.speed;
    // Collision
    const dx = playerCar.position.x - car.position.x;
    const dz = playerCar.position.z - car.position.z;
    if(Math.abs(dx)<1 && Math.abs(dz)<1){
      alert('Game Over! Score: '+score);
      document.location.reload();
    }
    // Remove cars behind player
    if(car.position.z > 10){
      scene.remove(car);
      aiCars.splice(aiCars.indexOf(car),1);
      score++;
    }
  });

  // Camera follows player
  camera.position.z = playerCar.position.z + 20;
  camera.position.x = playerCar.position.x;
  camera.lookAt(playerCar.position);

  // Update HUD
  document.getElementById('speedometer').innerText = 'Speed: '+Math.round(speed*300)+' km/h';
  document.getElementById('score').innerText = 'Score: '+score;
}

// Spawn AI cars regularly
setInterval(spawnAICar, 1000);

// Render loop
function animate(){
  requestAnimationFrame(animate);
  update();
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
